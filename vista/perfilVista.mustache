<link rel="stylesheet" href="/TP-Final-PW2/assets/css/perfil.css">

<div class="background">
    <div class="circle c1"></div>
    <div class="circle c2"></div>
    <div class="circle c3"></div>
    <div class="circle c4"></div>
</div>

<div class="container perfil-container">
    <!-- Cabecera del Perfil -->
    <div class="profile-header">
        <div class="profile-avatar">
            <img src="/TP-Final-PW2/{{usuario.foto_perfil}}" alt="Avatar" onerror="this.src='/TP-Final-PW2/assets/img/default-avatar.png'">
        </div>
        <div class="profile-info">
            <h1>{{usuario.nombre_completo}}</h1>
            <p class="username">@{{usuario.nombre_usuario}}</p>
            <div class="profile-meta">
                <span class="badge bg-primary">Ranking: #{{posicion}}</span>
                <span class="badge bg-success">{{usuario.pais}}, {{usuario.ciudad}}</span>
                <span class="badge bg-warning">Nivel: {{usuario.nivel}}</span>
            </div>
        </div>
        <div class="profile-qr">
            <div id="qrcode"></div>
            <p class="qr-label">Escanea para ver perfil</p>
        </div>
    </div>

    <div class="stats-section">
        <h2>üìä Estad√≠sticas</h2>
        <div class="row">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">üéÆ</div>
                    <div class="stat-value">{{estadisticas.total_partidas}}</div>
                    <div class="stat-label">Partidas Jugadas</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-value">{{estadisticas.partidas_ganadas}}</div>
                    <div class="stat-label">Partidas Ganadas</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-value">{{estadisticas.preguntas_correctas}}</div>
                    <div class="stat-label">Respuestas Correctas</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-value">{{estadisticas.porcentaje_acierto}}%</div>
                    <div class="stat-label">% de Acierto</div>
                </div>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <div class="stat-card puntaje-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-value">{{usuario.puntaje_total}}</div>
                    <div class="stat-label">Puntaje M√°ximo</div>
                </div>
            </div>
        </div>
    </div>

    <div class="history-section">
        <h2> Historial de Partidas</h2>
        {{#partidas}}
        <div class="partida-card">
            <div class="partida-header">
                <span class="partida-modo">
                    {{#esSolitario}} Solitario{{/esSolitario}}
                    {{^esSolitario}} Versus{{/esSolitario}}
                </span>
                <span class="partida-fecha">{{fecha_fin_formateada}}</span>
            </div>
            <div class="partida-body">
                <div class="partida-stats">
                    <span class="stat-item">
                        <strong>{{respuestas_correctas}}</strong> / {{total_respuestas}} correctas
                    </span>
                    <span class="stat-item">
                        Puntaje: <strong>{{puntaje_obtenido}}</strong>
                    </span>
                </div>
                {{#oponente_nombre}}
                <div class="partida-oponente">
                    <small>vs {{oponente_nombre}}</small>
                    {{#esGanador}}
                        <span class="badge bg-success">Victoria</span>
                    {{/esGanador}}
                    {{^esGanador}}
                        <span class="badge bg-danger">Derrota</span>
                    {{/esGanador}}
                </div>
                {{/oponente_nombre}}
            </div>
        </div>
        {{/partidas}}
        
        {{^partidas}}
        <div class="no-partidas">
            <p>Este jugador a√∫n no ha jugado ninguna partida.</p>
        </div>
        {{/partidas}}
    </div>

    <div class="action-buttons">
        {{#esPerfilPropio}}
            <a href="/TP-Final-PW2/game/singleplayer" class="btn btn-primary btn-lg">Jugar Ahora</a>
        {{/esPerfilPropio}}
        {{^esPerfilPropio}}
            <button class="btn btn-warning btn-lg" onclick="alert('Funcion para proxima entrega de TP')">
                ‚öîÔ∏è Desafiar
            </button>
        {{/esPerfilPropio}}
        <a href="/TP-Final-PW2/ranking/" class="btn btn-secondary btn-lg">Ver Ranking</a>
        <a href="/TP-Final-PW2/inicio/" class="btn btn-outline-secondary btn-lg">Volver al Inicio</a>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
    // Generar c√≥digo QR
    document.addEventListener('DOMContentLoaded', function() {
        new QRCode(document.getElementById("qrcode"), {
            text: "{{urlPerfil}}",
            width: 150,
            height: 150,
            colorDark: "#000000",
            colorLight: "#ffffff",
            correctLevel: QRCode.CorrectLevel.H
        });

        // Formatear fechas si no vienen formateadas
        document.querySelectorAll('.partida-fecha').forEach(function(elem) {
            const fechaTexto = elem.textContent.trim();
            if (fechaTexto && !fechaTexto.includes('/')) {
                const fecha = new Date(fechaTexto);
                if (!isNaN(fecha)) {
                    elem.textContent = fecha.toLocaleDateString('es-AR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
            }
        });
    });
</script>